var game,__currentPlayer,__displayObjects=[],__currentNPCConversing="";function parseTextToDisplayObject(e){switch(typeof e){case"function":return e();case"object":return Array.isArray(e)?e.join(""):"";default:return e}}function msg(e){const t=parseTextToDisplayObject(e);__displayObjects.push(t)}function checkIfLetter(e){return e.toUpperCase()!=e.toLowerCase()}function showNextButton(){document.getElementById("Next-Button").innerHTML='<p><button type="submit" id="Next-Button" onclick="refresh();">âžž</button></p>'}function hideNextButton(){document.getElementById("Next-Button").innerHTML=""}function hideActions(){document.getElementById("Actions").innerHTML=""}function handleStringCaps(e){for(var t="",n=(e=e+" ").length,o=0,r=!1,s=!0;o<n;){if("<"===e[o]&&(r=!0),">"===e[o]&&(r=!1),!1===r){var c=e[o];"."===c||"!"===c||"?"===c?('"'!==e[o+1]&&(s=!0),t+=c):!0===s&&checkIfLetter(c)?(t+=c.toUpperCase(),s=!1):t+=c}else t+=e[o];o++}return t}function getSpecialDescriptions(e){const t=["things","characters","scenery"];for(const n of t)if(game.rooms[e][n])for(const t of game.rooms[e][n])if(game[n][t].desc){msg(`<p>${parseTextToDisplayObject(game[n][t].desc)}</p>`)}}function refresh(){var e="";const t=getRoomOfCharacter(__currentPlayer),n=game.rooms[t];hideNextButton(),hideActions(),0===__displayObjects.length?(msg(n.desc),getSpecialDescriptions(t)):""===__currentNPCConversing&&showNextButton();const o=document.getElementById("Readout");if(o){for(const t of __displayObjects)e+=t;e=handleStringCaps(e=addHyperLinks(t,e)),o.innerHTML=e}__displayObjects=[]}function getNoun(e,t){var n=t;if(game[e][t]){var o=game[e][t];o&&(o.properNoun?n="function"==typeof o.properNoun?o.properNoun():o.properNoun:o.noun&&(n="function"==typeof o.noun?o.noun():o.noun))}return n}function addHyperLinks(e,t){const n='<a href="javascript:void(0);" onclick="handle',o=["things","characters","scenery"];for(const r of o)if(game.rooms[e][r])for(const o of game.rooms[e][r])for(;t.indexOf(`$${o}`)>-1;){const s=t.indexOf(`$${o}`),c=o.length,a=getNoun(r,o);t=__currentNPCConversing!==o?t.slice(0,s)+n+`Click('${r}','${e}','${o}');">${a}</a>`+t.slice(s+c+1,t.length):t.slice(0,s)+`${a}`+t.slice(s+c+1,t.length)}if(game.rooms[e].decorations)for(const[o,r]of game.rooms[e].decorations)for(;t.indexOf(`$${o}`)>-1;){const e=t.indexOf(`$${o}`),s=o.length;t=t.slice(0,e)+n+`Decorator('${o}','${r}');">${o}</a>`+t.slice(e+s+1,t.length)}return t}function handleDecorator(e,t){msg(t),refresh()}function handleTopic(e,t){var n=game.characters[e];if(n){const e=(n.states&&n.currentState?n.states[n.currentState]:n.topics)[t]();e&&(msg(e),refresh())}}function handleAction(e,t,n){var o=game[e][t];if(o){const e=o.actions[n]();e&&(msg(e),refresh())}}function handleClick(e,t,n){var o=game[e][n];if(o){var r={catagory:e,container:t,name:n,it:o};if(o.hello){const e=o.hello(r);if(e)return __currentNPCConversing=n,msg(e),void refresh()}if(o.click){const t=o.click(r);if(t&&(msg(t),refresh()),o.actions){const t=buildActionsHTML(e,o.actions,n);document.getElementById("Actions").innerHTML=handleStringCaps(t)}}}}function deleteCharacter(e){const t=getRoomOfCharacter(e);if(game.rooms[t].characters){const n=game.rooms[t].characters.indexOf(e);game.rooms[t].characters.splice(n,1)}}function putCharacterInRoom(e,t){game.rooms[t]&&(game.rooms[t].characters||(game.rooms[t].characters=[]),game.rooms[t].characters.push(e))}function silentMoveCharacterToRoom(e,t){deleteCharacter(e),putCharacterInRoom(e,t)}function moveCharacterToRoom(e,t){const n=game.characters[e];n.moveMessage&&n.moveMessage(t),silentMoveCharacterToRoom(e,t)}function deleteThing(e){const t=getRoomOfThing(e);if(game.rooms[t].things){const n=game.rooms[t].things.indexOf(e);game.rooms[t].things.splice(n,1)}}function putThingInRoom(e,t){game.rooms[t]&&(game.rooms[t].things||(game.rooms[t].things=[]),game.rooms[t].things.push(e))}function silentMoveThingToRoom(e,t){deleteThing(e),putThingInRoom(e,t)}function moveThingToRoom(e,t){const n=game.things[e];n.moveMessage&&n.moveMessage(t),silentMoveThingToRoom(e,t)}function getRoomOfThing(e){const t=game.rooms;for(const[n,o]of Object.entries(t))if(o.thing&&o.thing.indexOf(e)>-1)return n;return""}function getRoomOfCharacter(e){const t=game.rooms;for(const[n,o]of Object.entries(t))if(o.characters&&o.characters.indexOf(e)>-1)return n;return""}function restartGame(){const e=Object.create(metaInfo);document.title=e.title,__currentPlayer=e.startingPlayer,__currentNPCConversing="",game=Object.create(Game)}function startGame(){window.addEventListener("orientationchange",function(){}),restartGame(),refresh()}